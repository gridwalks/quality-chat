<!DOCTYPE html><html lang='en'><head><meta charset='UTF-8'/><meta name='viewport' content='width=device-width, initial-scale=1'/><title>Admin · Resources Editor</title>
  <link rel='preconnect' href='https://fonts.googleapis.com'>
  <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
  <link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap' rel='stylesheet'>
  <script src='https://cdn.tailwindcss.com'></script>
  <script defer src='https://identity.netlify.com/v1/netlify-identity-widget.js'></script>
  <style>body{font-family:Inter,system-ui,sans-serif}</style>
</head><body class='bg-gray-50 text-gray-900'><div class='max-w-5xl mx-auto p-6'>  <div class='flex items-center justify-between mb-6'>    <h1 class='text-2xl font-bold'>Resources Editor</h1>    <a href='/admin/' class='px-3 py-2 rounded border bg-white'>← Admin</a>  </div>  <div id='auth' class='text-sm text-gray-600 mb-4'>Checking login…</div>  <div class='mb-3 flex flex-wrap gap-2'>    <button id='load' class='px-3 py-2 rounded border bg-white' disabled>Load faqs.json</button>    <button id='download' class='px-3 py-2 rounded bg-indigo-600 text-white rounded-md' disabled>Download updated faqs.json</button>  </div>  <p class='text-sm text-gray-600 mb-4'>Edit the <code>resources</code> links for each FAQ. Download and replace <code>/knowledge/faqs.json</code> to publish.</p>  <div id='list' class='space-y-3'></div></div><template id='row'>  <details class='bg-white border rounded-xl shadow-sm'>    <summary class='cursor-pointer list-none p-4 flex items-center justify-between'>      <span class='font-semibold title'>Title</span>      <span class='text-xs text-gray-500 id'>id</span>    </summary>    <div class='p-4 pt-0'>      <div class='text-xs text-gray-600 mb-2'>Add, edit, or remove resources.</div>      <div class='space-y-2 resources'></div>      <div class='mt-3 flex gap-2'>        <button class='px-3 py-2 rounded border bg-white add-resource'>+ Add resource</button>        <button class='px-3 py-2 rounded border bg-white clear-resources'>Clear all</button>      </div>    </div>  </details></template><template id='resRow'>  <div class='grid md:grid-cols-2 gap-2 items-start border rounded-lg p-3'>    <label class='text-sm'>Label<input class='w-full border rounded p-2 mt-1 label' placeholder='e.g., FDA 21 CFR Part 11 Full Text'/></label>    <label class='text-sm'>URL<input class='w-full border rounded p-2 mt-1 url' placeholder='https://...'/></label>    <div class='md:col-span-2 flex justify-end'>      <button class='px-3 py-2 rounded border bg-white del'>Remove</button>    </div>  </div></template><script>  const auth=document.getElementById('auth'); const loadBtn=document.getElementById('load'); const dlBtn=document.getElementById('download'); const list=document.getElementById('list'); const rowTpl=document.getElementById('row'); const resTpl=document.getElementById('resRow'); let data=[];  function enable(b){ [loadBtn, dlBtn].forEach(x=>x.disabled=!b); }  function gate(user){ if(!user){ location.replace('/login.html'); return; } const roles=(user.app_metadata&&user.app_metadata.roles)||[]; if(!roles.includes('admin')){ location.replace('/access-denied.html'); return; } auth.textContent='Signed in as '+user.email+' (admin)'; enable(true); }  document.addEventListener('DOMContentLoaded',()=>{ if(window.netlifyIdentity){ window.netlifyIdentity.on('init',gate); window.netlifyIdentity.init(); } else { location.replace('/login.html'); } });  function render(){ list.innerHTML=''; data.forEach((item,idx)=>{ const node=rowTpl.content.cloneNode(true); node.querySelector('.title').textContent=item.title||'(untitled)'; node.querySelector('.id').textContent=item.id||''; const resWrap=node.querySelector('.resources'); const ensure=()=>{ if(!Array.isArray(data[idx].resources)) data[idx].resources=[]; }; (item.resources||[]).forEach((r,ridx)=>{ const rnode=resTpl.content.cloneNode(true); rnode.querySelector('.label').value=r.label||''; rnode.querySelector('.url').value=r.url||''; rnode.querySelector('.label').addEventListener('input',e=>{ ensure(); data[idx].resources[ridx].label=e.target.value; }); rnode.querySelector('.url').addEventListener('input',e=>{ ensure(); data[idx].resources[ridx].url=e.target.value; }); rnode.querySelector('.del').addEventListener('click',()=>{ ensure(); data[idx].resources.splice(ridx,1); render(); }); resWrap.appendChild(rnode); }); node.querySelector('.add-resource').addEventListener('click',()=>{ ensure(); data[idx].resources.push({label:'',url:''}); render(); }); node.querySelector('.clear-resources').addEventListener('click',()=>{ data[idx].resources=[]; render(); }); list.appendChild(node); }); }  loadBtn.addEventListener('click', async()=>{ const res=await fetch('/knowledge/faqs.json',{cache:'no-store'}); data=await res.json(); data=data.map(x=>Object.assign({},x,{resources:Array.isArray(x.resources)?x.resources:[]})); render(); });  dlBtn.addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='faqs.json'; a.click(); URL.revokeObjectURL(url); });</script></body></html>